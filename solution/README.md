# project

## Описание проекта

Этот проект представляет собой рекламную платформу, которая позволяет рекламодателям управлять своими рекламными кампаниями.

## Инструкция по запуску

### Требования

- Docker
- Docker Compose

### Запуск приложения

1. Клонируйте репозиторий:

    ```sh
    git clone https://gitlab.prodcontest.ru/2025-final-projects-back/ya-ilya.git
    cd project
    ```

2. Запустите Docker Compose:

    ```sh
    docker-compose up --build
    ```

   Эта команда запустит три сервиса:
    - `database`: MySQL база данных
    - `backend`: Spring Boot приложение
    - `grafana`: Grafana для визуализации данных

3. Приложение будет доступно по адресу `http://localhost:8080`.

### Структура `docker-compose.yml`

#### Сервисы
```
- database:
    container_name: database
    image: mysql
    environment: Переменные окружения для настройки базы данных MySQL.
        ...
    ports: Проброс порта 3306 на хосте на порт 33061 в контейнере.
    volumes: Использование тома mysql_data для хранения данных базы данных.
    networks: Подключение к сети net.
    healthcheck: Проверка состояния контейнера с интервалом 5 секунд.
    command: Настройка кодировки и коллации для MySQL.

- grafana:
    container_name: grafana
    image: grafana/grafana:latest
    ports: Проброс порта 3000 на хосте на порт 3000 в контейнере.
    environment: Переменные окружения для настройки Grafana.
        ...
    volumes: Использование тома grafana_data для хранения данных Grafana.
    networks: Подключение к сети net.

- backend:
    container_name: backend
    build: Настройки сборки контейнера.
        ...
    environment:
      TEXT_MODERATION: Если значение true, то модерация текстов будет включена. По умолчанию false.
    ports: Проброс порта 8080 на хосте на порт 8080 в контейнере.
    networks: Подключение к сети net.
    volumes: Использование тома backend_data для хранения изображений.
    depends_on: Зависимость от сервиса database с условием service_healthy.
```
#### Тома

- `mysql_data`: Том для хранения данных базы данных MySQL.
- `grafana_data`: Том для хранения данных Grafana.
- `images`: Том для хранения изображений.

#### Сети

- `net`: Общая сеть для взаимодействия сервисов.

### Схема данных СУБД

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="assets/database_dark.svg">
  <img alt="database" src="assets/database_light.svg">
</picture>

### Описание работы метода показа рекламы

Процесс поиска релевантной рекламы состоит из двух этапов - фильтрация и сортировка.
- Фильтрация отсеивает кампании, которые подходят по параметрам клиента, а также являются активными в данный момент.
- Сортировка нужна, чтобы выбрать наиболее релевантную рекламную кампанию.
Она учитывает различные показатели, про которые сказано чуть ниже.

Учитываемые показатели при фильтрации:
- Пол должен быть либо такой же, либо ALL
- Возраст должен быть больше или равен минимальному, и меньше или равен максимальному
- Локация должна полностью совпадать (вплоть до case)
- Количество показов либо количество кликов должны не превышать лимиты
- Текущая дата должна быть больше или равна дате начала, и меньше или равна дате окончания

Учитываемые показатели при сортировке:
- ML-скор (по убыванию). Вес - 3
- Количество неуникальных показов данному пользователю (по возрастанию). Вес - 1
- Количество неуникальных кликов от данного пользователя (по убыванию). Вес - 2
- Конверсия (по убыванию). Вес - 3
- Количество оставшихся показов (по убыванию). Вес - 1
- Количество оставшихся кликов (по убыванию). Вес - 2
- Цена за показ (по убыванию). Вес - 1
- Цена за клик (по убыванию). Вес - 1